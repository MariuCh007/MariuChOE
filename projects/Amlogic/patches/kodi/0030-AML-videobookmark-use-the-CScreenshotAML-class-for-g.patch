From aee1082b9366b7ef4168e6f419d9d183e76891ae Mon Sep 17 00:00:00 2001
From: Memphiz <memphis@machzwo.de>
Date: Tue, 27 Jan 2015 00:05:36 +0100
Subject: [PATCH 30/30] [AML/videobookmark] - use the CScreenshotAML class for
 generating video bookmarks on amlogic

---
 xbmc/video/dialogs/GUIDialogVideoBookmarks.cpp |   12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/xbmc/video/dialogs/GUIDialogVideoBookmarks.cpp b/xbmc/video/dialogs/GUIDialogVideoBookmarks.cpp
index 1ccabc8..fb61484 100644
--- a/xbmc/video/dialogs/GUIDialogVideoBookmarks.cpp
+++ b/xbmc/video/dialogs/GUIDialogVideoBookmarks.cpp
@@ -25,7 +25,10 @@
 #ifdef HAS_VIDEO_PLAYBACK
 #include "cores/VideoRenderers/RenderManager.h"
 #include "cores/VideoRenderers/RenderCapture.h"
-#endif
+#if defined(HAS_LIBAMCODEC)
+#include "utils/ScreenshotAML.h"
+#endif//HAS_LIBAMCODEC
+#endif//HAS_VIDEO_PLAYBACK
 #include "pictures/Picture.h"
 #include "dialogs/GUIDialogContextMenu.h"
 #include "view/ViewState.h"
@@ -339,8 +342,13 @@ bool CGUIDialogVideoBookmarks::AddBookmark(CVideoInfoTag* tag)
     {
       g_renderManager.Capture(thumbnail, width, height, CAPTUREFLAG_IMMEDIATELY);
 
+#if !defined(HAS_LIBAMCODEC)
       if (thumbnail->GetUserState() == CAPTURESTATE_DONE)
       {
+#else//HAS_LIBAMCODEC
+      {
+        CScreenshotAML::CaptureVideoFrame(thumbnail->GetPixels(), width, height, false);
+#endif
         Crc32 crc;
         crc.ComputeFromLowerCase(g_application.CurrentFile());
         bookmark.thumbNailImage = StringUtils::Format("%08x_%i.jpg", (unsigned __int32) crc, (int)bookmark.timeInSeconds);
@@ -349,8 +357,10 @@ bool CGUIDialogVideoBookmarks::AddBookmark(CVideoInfoTag* tag)
                                             bookmark.thumbNailImage))
           bookmark.thumbNailImage.clear();
       }
+#if !defined(HAS_LIBAMCODEC)
       else
         CLog::Log(LOGERROR,"CGUIDialogVideoBookmarks: failed to create thumbnail");
+#endif
 
       g_renderManager.ReleaseRenderCapture(thumbnail);
     }
-- 
1.7.10.4

